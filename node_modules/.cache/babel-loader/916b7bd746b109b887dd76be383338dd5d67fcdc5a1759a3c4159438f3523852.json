{"ast":null,"code":"const apiKey = process.env.REACT_APP_GOOGLE_MAPS_API_KEY;\nexport const loadGoogleMapsScript = callback => {\n  if (window.google && window.google.maps) {\n    callback();\n    return;\n  }\n  const script = document.createElement('script');\n  script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&libraries=places`;\n  script.async = true;\n  script.defer = true;\n  script.onload = () => callback();\n  document.head.appendChild(script);\n};\nexport const fetchNearbyUtilities = (lat, lng, radius, category) => {\n  //console.log(category);\n\n  return new Promise((resolve, reject) => {\n    loadGoogleMapsScript(() => {\n      const service = new window.google.maps.places.PlacesService(document.createElement('div'));\n      const request = {\n        location: new window.google.maps.LatLng(lat, lng),\n        radius,\n        type: category\n      };\n      let utilities = [];\n      const callback = (results, status, pagination) => {\n        if (status === window.google.maps.places.PlacesServiceStatus.OK) {\n          utilities = utilities.concat(results.map(utility => ({\n            name: utility.name,\n            lat: utility.geometry.location.lat(),\n            lng: utility.geometry.location.lng()\n          })));\n\n          // Check if there's a next page and if so, fetch more results\n          if (pagination && pagination.hasNextPage) {\n            // Wait a short time before making the next request to avoid errors\n            setTimeout(() => pagination.nextPage(), 500);\n          } else {\n            resolve(utilities); // No more pages or not paginating further, resolve promise\n          }\n        } else if (status === window.google.maps.places.PlacesServiceStatus.ZERO_RESULTS) {\n          resolve([]); // Resolve with an empty array for no results\n        } else {\n          reject('Failed to fetch nearby utilities');\n        }\n      };\n      service.nearbySearch(request, callback);\n    });\n  });\n};","map":{"version":3,"names":["apiKey","process","env","REACT_APP_GOOGLE_MAPS_API_KEY","loadGoogleMapsScript","callback","window","google","maps","script","document","createElement","src","async","defer","onload","head","appendChild","fetchNearbyUtilities","lat","lng","radius","category","Promise","resolve","reject","service","places","PlacesService","request","location","LatLng","type","utilities","results","status","pagination","PlacesServiceStatus","OK","concat","map","utility","name","geometry","hasNextPage","setTimeout","nextPage","ZERO_RESULTS","nearbySearch"],"sources":["C:/Users/pierk/OneDrive/Desktop/courseraRxNtv/WalkReadyUs/src/FetchNearby.js"],"sourcesContent":["const apiKey = process.env.REACT_APP_GOOGLE_MAPS_API_KEY;\r\n\r\nexport const loadGoogleMapsScript = (callback) => {\r\n    if (window.google && window.google.maps) {\r\n      callback();\r\n      return;\r\n    }\r\n  \r\n    const script = document.createElement('script');\r\n    script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&libraries=places`;\r\n    script.async = true;\r\n    script.defer = true;\r\n    script.onload = () => callback();\r\n    document.head.appendChild(script);\r\n  };\r\n  \r\n  export const fetchNearbyUtilities = (lat, lng, radius, category) => {\r\n    //console.log(category);\r\n\r\n    return new Promise((resolve, reject) => {\r\n      loadGoogleMapsScript(() => {\r\n        const service = new window.google.maps.places.PlacesService(document.createElement('div'));\r\n        const request = {\r\n          location: new window.google.maps.LatLng(lat, lng),\r\n          radius,\r\n          type: category,\r\n        };\r\n  \r\n        let utilities = [];\r\n  \r\n        const callback = (results, status, pagination) => {\r\n          if (status === window.google.maps.places.PlacesServiceStatus.OK) {\r\n            utilities = utilities.concat(results.map(utility => ({\r\n              name: utility.name,\r\n              lat: utility.geometry.location.lat(),\r\n              lng: utility.geometry.location.lng(),\r\n            })));\r\n  \r\n            // Check if there's a next page and if so, fetch more results\r\n            if (pagination && pagination.hasNextPage) {\r\n              // Wait a short time before making the next request to avoid errors\r\n              setTimeout(() => pagination.nextPage(), 500);\r\n            } else {\r\n              resolve(utilities); // No more pages or not paginating further, resolve promise\r\n            }\r\n          } else if (status === window.google.maps.places.PlacesServiceStatus.ZERO_RESULTS) {\r\n            resolve([]); // Resolve with an empty array for no results\r\n          } else {\r\n            reject('Failed to fetch nearby utilities');\r\n          }\r\n        };\r\n  \r\n        service.nearbySearch(request, callback);\r\n      });\r\n    });\r\n  };\r\n  "],"mappings":"AAAA,MAAMA,MAAM,GAAGC,OAAO,CAACC,GAAG,CAACC,6BAA6B;AAExD,OAAO,MAAMC,oBAAoB,GAAIC,QAAQ,IAAK;EAC9C,IAAIC,MAAM,CAACC,MAAM,IAAID,MAAM,CAACC,MAAM,CAACC,IAAI,EAAE;IACvCH,QAAQ,CAAC,CAAC;IACV;EACF;EAEA,MAAMI,MAAM,GAAGC,QAAQ,CAACC,aAAa,CAAC,QAAQ,CAAC;EAC/CF,MAAM,CAACG,GAAG,GAAI,+CAA8CZ,MAAO,mBAAkB;EACrFS,MAAM,CAACI,KAAK,GAAG,IAAI;EACnBJ,MAAM,CAACK,KAAK,GAAG,IAAI;EACnBL,MAAM,CAACM,MAAM,GAAG,MAAMV,QAAQ,CAAC,CAAC;EAChCK,QAAQ,CAACM,IAAI,CAACC,WAAW,CAACR,MAAM,CAAC;AACnC,CAAC;AAED,OAAO,MAAMS,oBAAoB,GAAGA,CAACC,GAAG,EAAEC,GAAG,EAAEC,MAAM,EAAEC,QAAQ,KAAK;EAClE;;EAEA,OAAO,IAAIC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;IACtCrB,oBAAoB,CAAC,MAAM;MACzB,MAAMsB,OAAO,GAAG,IAAIpB,MAAM,CAACC,MAAM,CAACC,IAAI,CAACmB,MAAM,CAACC,aAAa,CAAClB,QAAQ,CAACC,aAAa,CAAC,KAAK,CAAC,CAAC;MAC1F,MAAMkB,OAAO,GAAG;QACdC,QAAQ,EAAE,IAAIxB,MAAM,CAACC,MAAM,CAACC,IAAI,CAACuB,MAAM,CAACZ,GAAG,EAAEC,GAAG,CAAC;QACjDC,MAAM;QACNW,IAAI,EAAEV;MACR,CAAC;MAED,IAAIW,SAAS,GAAG,EAAE;MAElB,MAAM5B,QAAQ,GAAGA,CAAC6B,OAAO,EAAEC,MAAM,EAAEC,UAAU,KAAK;QAChD,IAAID,MAAM,KAAK7B,MAAM,CAACC,MAAM,CAACC,IAAI,CAACmB,MAAM,CAACU,mBAAmB,CAACC,EAAE,EAAE;UAC/DL,SAAS,GAAGA,SAAS,CAACM,MAAM,CAACL,OAAO,CAACM,GAAG,CAACC,OAAO,KAAK;YACnDC,IAAI,EAAED,OAAO,CAACC,IAAI;YAClBvB,GAAG,EAAEsB,OAAO,CAACE,QAAQ,CAACb,QAAQ,CAACX,GAAG,CAAC,CAAC;YACpCC,GAAG,EAAEqB,OAAO,CAACE,QAAQ,CAACb,QAAQ,CAACV,GAAG,CAAC;UACrC,CAAC,CAAC,CAAC,CAAC;;UAEJ;UACA,IAAIgB,UAAU,IAAIA,UAAU,CAACQ,WAAW,EAAE;YACxC;YACAC,UAAU,CAAC,MAAMT,UAAU,CAACU,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC;UAC9C,CAAC,MAAM;YACLtB,OAAO,CAACS,SAAS,CAAC,CAAC,CAAC;UACtB;QACF,CAAC,MAAM,IAAIE,MAAM,KAAK7B,MAAM,CAACC,MAAM,CAACC,IAAI,CAACmB,MAAM,CAACU,mBAAmB,CAACU,YAAY,EAAE;UAChFvB,OAAO,CAAC,EAAE,CAAC,CAAC,CAAC;QACf,CAAC,MAAM;UACLC,MAAM,CAAC,kCAAkC,CAAC;QAC5C;MACF,CAAC;MAEDC,OAAO,CAACsB,YAAY,CAACnB,OAAO,EAAExB,QAAQ,CAAC;IACzC,CAAC,CAAC;EACJ,CAAC,CAAC;AACJ,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}